rules_version = '2';
service cloud.firestore {
	match /databases/{database}/documents {
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;

      match /projects/{projectId} {
        allow read: if true;

        allow create: if areFieldsValidForCreate(request.resource.data);
        allow update: if areFieldsValidForUpdate(request.resource.data);

        function areFieldsValidForCreate(document) {
          return document.name is string &&
            document.strawberrySize is number &&
            document.numberOfStrawberries is number &&
            document.breakSize is number &&
            document.description is string;
        }
        function areFieldsValidForUpdate(doc) {
          return doc.keys().hasAny([
            'name', 'strawberrySize', 'numberOfStrawberries', 'breakSize', 'description'
          ]) && (
            doc.get('name', '') is string &&
            doc.get('strawberrySize', 0) is number &&
            doc.get('numberOfStrawberries', 0) is number &&
            doc.get('breakSize', 0) is number &&
            doc.get('description', '') is string
          );
        }
      }
    }    
  }
}
